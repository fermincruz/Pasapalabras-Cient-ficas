<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuración y Juego</title>
  <style>
    /* ==================== ESTILOS COMUNES ==================== */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    /* Fondo para ambas secciones */
    .bg {
      background: linear-gradient(135deg, #74ebd5, #acb6e5);
    }
    
    /* ==================== PÁGINA DE CONFIGURACIÓN ==================== */
    #config-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #config-page form {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
      max-width: 400px;
      width: 90%;
    }
    #config-page h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    #config-page label {
      display: block;
      margin-bottom: 5px;
      font-size: 18px;
    }
    #config-page input, #config-page select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      font-size: 16px;
      box-sizing: border-box;
    }
    #config-page button {
      width: 100%;
      padding: 10px;
      font-size: 18px;
      background-color: #27ae60;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #config-page button:hover {
      background-color: #219150;
    }
    /* Contenedor para los campos de nombres de equipos */
    #team-names-container input {
      margin-bottom: 10px;
    }
    
    /* ==================== PÁGINA DEL JUEGO ==================== */
    /* Contenedor principal del juego: dos columnas (izquierda y derecha) */
    #game-page {
      display: none;
    }
    .game-container {
      display: flex;
      width: 100vw;
      height: 100vh;
    }
    /* Izquierda (30%): Temporizador y marcadores */
    .left-container {
      width: 30%;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    /* Temporizador y controles en la parte superior */
    .timer-section {
      text-align: center;
    }
    .timer {
      /* El tamaño se ajusta; puedes modificar el valor (en vw) según convenga */
      font-size: 16vw;
      color: #2ecc71;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
      transition: color 0.5s ease;
      white-space: nowrap;
      margin-bottom: 10px;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .warning {
      color: #e74c3c;
      animation: pulse 1s infinite;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .controls button {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background-color 0.3s;
    }
    .start-btn {
      background-color: #27ae60;
    }
    .start-btn:hover {
      background-color: #219150;
    }
    .reset-btn {
      background-color: #c0392b;
    }
    .reset-btn:hover {
      background-color: #a83224;
    }
    .controls svg {
      width: 24px;
      height: 24px;
      fill: #fff;
    }
    /* Marcadores organizados en cuadrícula 2x2 */
    .teams-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .team-card {
      padding: 10px;
      border: 3px solid #333;
      border-radius: 10px;
      background-color: #fff;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    .team-card h2 {
      margin: 10px 0;
      font-size: 24px;
    }
    .score {
      font-size: 48px;
      margin: 10px 0;
    }
    .score-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .score-controls button {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 50%;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .score-add {
      background-color: #27ae60;
      color: #fff;
    }
    .score-add:hover {
      background-color: #219150;
    }
    .score-subtract {
      background-color: #c0392b;
      color: #fff;
    }
    .score-subtract:hover {
      background-color: #a83224;
    }
    /* Derecha (70): Visor de PDF */
    .right-container {
      width: 70%;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      background: #fff;
    }
    .pdf-viewer {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }
    #pdf-canvas {
      width: 100%;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    .pdf-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .pdf-controls button {
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body class="bg">
  <!-- PÁGINA DE CONFIGURACIÓN -->
  <div id="config-page" class="bg">
    <form id="config-form">
      <h1>Configuración del Juego</h1>
      <label for="config-time">Tiempo para cada pregunta (segundos):</label>
      <input type="number" id="config-time" min="1" value="30" required>
      
      <label for="config-num-teams">Número de equipos:</label>
      <select id="config-num-teams" required>
        <option value="1">1</option>
        <option value="2" selected>2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
      </select>
      
      <div id="team-names-container">
        <!-- Se generarán aquí los inputs para los nombres de los equipos -->
      </div>
      
      <button type="submit">Comenzar Juego</button>
    </form>
  </div>
  
  <!-- PÁGINA DEL JUEGO -->
  <div id="game-page" class="bg">
    <div class="game-container">
      <!-- Izquierda: Temporizador arriba y marcadores en cuadrícula 2x2 abajo -->
      <div class="left-container">
        <div class="timer-section">
          <div class="timer" id="timer">30</div>
          <div class="controls">
            <button class="start-btn" id="startButton" title="Comenzar">
              <!-- Icono de Play -->
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <polygon points="16,12 16,52 48,32"/>
              </svg>
            </button>
            <button class="reset-btn" id="resetButton" title="Reset">
              <!-- Icono de Refresh -->
              <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <path d="M32,12c-11.046,0-20,8.954-20,20h4c0-8.822,7.178-16,16-16s16,7.178,16,16c0,7.732-5.44,14.164-12.708,15.673l3.711,3.711L32,52
                  l-8.003-8.003l3.711-3.711C21.44,38.164,16,31.732,16,24h4C20,20.134,24.134,16,28,16S36,20.134,36,24S31.866,32,28,32H16v8h12
                  c4.418,0,8-3.582,8-8S32.418,12,28,12H32z"/>
              </svg>
            </button>
          </div>
        </div>
        <!-- Marcadores en cuadrícula 2x2 -->
        <div id="teams-container" class="teams-grid"></div>
      </div>
      <!-- Derecha: Visor de PDF -->
      <div class="right-container">
        <div class="pdf-viewer">
          <canvas id="pdf-canvas"></canvas>
          <div class="pdf-controls">
            <button id="prev">Anterior</button>
            <span>Página <span id="page_num"></span> / <span id="page_count"></span></span>
            <button id="next">Siguiente</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ==================== SCRIPTS ==================== -->
  <!-- PDF.js (desde CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    /********************* CONFIGURACIÓN *********************/
    const configForm = document.getElementById('config-form');
    const numTeamsSelect = document.getElementById('config-num-teams');
    const teamNamesContainer = document.getElementById('team-names-container');
    
    // Función para generar inputs para los nombres de equipos según el número elegido
    function generateTeamInputs(num) {
      teamNamesContainer.innerHTML = ''; // Limpiar
      for (let i = 1; i <= num; i++) {
        const label = document.createElement('label');
        label.textContent = `Nombre del Equipo ${i}:`;
        const input = document.createElement('input');
        input.type = 'text';
        input.id = `team-name-${i}`;
        input.placeholder = `Equipo ${i}`;
        input.required = true;
        teamNamesContainer.appendChild(label);
        teamNamesContainer.appendChild(input);
      }
    }
    // Genera los inputs inicialmente según el valor seleccionado por defecto
    generateTeamInputs(numTeamsSelect.value);
    // Actualiza los inputs al cambiar el número de equipos
    numTeamsSelect.addEventListener('change', (e) => {
      generateTeamInputs(e.target.value);
    });
    
    // Variables de configuración (globales)
    let configTime = 30;
    let configTeams = [];
    
    configForm.addEventListener('submit', (e) => {
      e.preventDefault();
      // Lee el tiempo configurado
      configTime = parseInt(document.getElementById('config-time').value, 10);
      // Lee el número de equipos y sus nombres
      const numTeams = parseInt(numTeamsSelect.value, 10);
      configTeams = [];
      for (let i = 1; i <= numTeams; i++) {
        const name = document.getElementById(`team-name-${i}`).value.trim();
        configTeams.push(name || `Equipo ${i}`);
      }
      // Oculta la página de configuración y muestra la del juego
      document.getElementById('config-page').style.display = 'none';
      document.getElementById('game-page').style.display = 'block';
      
      // Inicia la configuración del juego
      initGame();
      
      // Forzamos un re-render del PDF (con un breve retraso para que se asigne el layout)
      setTimeout(() => {
        renderPage(pageNum);
      }, 100);
    });
    
    /********************* JUEGO *********************/
    // Variables del temporizador y de la partida
    let tiempoInicial = configTime; // se actualizará al iniciar el juego
    let tiempoRestante = tiempoInicial;
    const timerElemento = document.getElementById('timer');
    const startButton = document.getElementById('startButton');
    const resetButton = document.getElementById('resetButton');
    
    // Variables para los equipos
    let scores = []; // Array de puntajes, uno por equipo
    
    // Inicializa el temporizador y genera los marcadores
    function initGame() {
      // Actualiza el tiempo inicial según la configuración
      tiempoInicial = configTime;
      tiempoRestante = tiempoInicial;
      actualizarTemporizador();
      
      // Inicializa el array de puntajes
      scores = configTeams.map(() => 0);
      
      // Genera las tarjetas de equipos en el contenedor "teams-container"
      const teamsContainer = document.getElementById('teams-container');
      teamsContainer.innerHTML = '';
      configTeams.forEach((teamName, index) => {
        // Asigna un color automáticamente (puedes personalizar)
        const colors = ["#3498db", "#e74c3c", "#2ecc71", "#f1c40f", "#9b59b6", "#e67e22", "#1abc9c", "#34495e"];
        const teamColor = colors[index % colors.length];
        
        const teamCard = document.createElement('div');
        teamCard.className = 'team-card';
        teamCard.style.borderColor = teamColor;
        teamCard.innerHTML = `
          <h2>${teamName}</h2>
          <div class="score" id="score-${index}">0</div>
          <div class="score-controls">
            <button class="score-add" data-team="${index}">+</button>
            <button class="score-subtract" data-team="${index}">−</button>
          </div>
        `;
        teamsContainer.appendChild(teamCard);
      });
      
      // Agregar event listeners a los botones de puntaje
      document.querySelectorAll('.score-add').forEach(button => {
        button.addEventListener('click', () => {
          const teamIndex = button.dataset.team;
          scores[teamIndex]++;
          actualizarMarcador(teamIndex);
        });
      });
      document.querySelectorAll('.score-subtract').forEach(button => {
        button.addEventListener('click', () => {
          const teamIndex = button.dataset.team;
          scores[teamIndex]--;
          actualizarMarcador(teamIndex);
        });
      });
    }
    
    function actualizarMarcador(teamIndex) {
      document.getElementById(`score-${teamIndex}`).textContent = scores[teamIndex];
    }
    
    // Temporizador y sonidos (usando Web Audio API)
    let audioCtx = null;
    function initAudioContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }
    function playBeep() {
      initAudioContext();
      const oscillator = audioCtx.createOscillator();
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(1000, audioCtx.currentTime);
      oscillator.connect(audioCtx.destination);
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.1);
    }
    function playHorn() {
      initAudioContext();
      const oscillator = audioCtx.createOscillator();
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
      oscillator.connect(audioCtx.destination);
      oscillator.start();
      oscillator.stop(audioCtx.currentTime + 0.5);
    }
    
    let cuentaAtrasInterval = null;
    function actualizarTemporizador() {
      timerElemento.textContent = tiempoRestante;
      if (tiempoRestante <= 10 && tiempoRestante > 0) {
        timerElemento.classList.add('warning');
      } else {
        timerElemento.classList.remove('warning');
      }
    }
    function iniciarCuentaAtras() {
      if (cuentaAtrasInterval !== null) return;
      tiempoRestante = tiempoInicial;
      actualizarTemporizador();
      cuentaAtrasInterval = setInterval(() => {
        tiempoRestante--;
        actualizarTemporizador();
        if (tiempoRestante <= 10 && tiempoRestante > 0) {
          playBeep();
        }
        if (tiempoRestante <= 0) {
          clearInterval(cuentaAtrasInterval);
          cuentaAtrasInterval = null;
          playHorn();
        }
      }, 1000);
    }
    function resetearTemporizador() {
      if (cuentaAtrasInterval !== null) {
        clearInterval(cuentaAtrasInterval);
        cuentaAtrasInterval = null;
      }
      tiempoRestante = tiempoInicial;
      actualizarTemporizador();
    }
    startButton.addEventListener('click', iniciarCuentaAtras);
    resetButton.addEventListener('click', resetearTemporizador);
    
    /******************* PDF VIEWER (con PDF.js) *******************/
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    let pdfDoc = null,
        pageNum = 1,
        pageRendering = false,
        pageNumPending = null,
        canvas = document.getElementById('pdf-canvas'),
        ctx = canvas.getContext('2d');
    
    function renderPage(num) {
      pageRendering = true;
      pdfDoc.getPage(num).then(function(page) {
        // Se obtiene el ancho disponible en el contenedor derecho
        const pdfContainer = document.querySelector('.right-container');
        const desiredWidth = pdfContainer.clientWidth;
        // Obtener el viewport en escala 1 para conocer el tamaño original
        const unscaledViewport = page.getViewport({ scale: 1 });
        // Calcular el factor de escala para ajustar al ancho disponible
        const scaleFactor = desiredWidth / unscaledViewport.width;
        const viewport = page.getViewport({ scale: scaleFactor });
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        const renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };
        const renderTask = page.render(renderContext);
        renderTask.promise.then(function() {
          pageRendering = false;
          if (pageNumPending !== null) {
            renderPage(pageNumPending);
            pageNumPending = null;
          }
        });
      });
      document.getElementById('page_num').textContent = num;
    }
    function queueRenderPage(num) {
      if (pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }
    function onPrevPage() {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    }
    document.getElementById('prev').addEventListener('click', onPrevPage);
    function onNextPage() {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    }
    document.getElementById('next').addEventListener('click', onNextPage);
    pdfjsLib.getDocument('Pasapalabras-Cientificas.pdf').promise.then(function(pdfDoc_) {
      pdfDoc = pdfDoc_;
      document.getElementById('page_count').textContent = pdfDoc.numPages;
      renderPage(pageNum);
    });
  </script>
</body>
</html>
